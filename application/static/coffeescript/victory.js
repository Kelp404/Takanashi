// Generated by CoffeeScript 1.6.3
(function() {
  var user_agent, victory;

  victory = {
    userLevel: {
      root: 0,
      normal: 1
    },
    loginUrl: '',
    isIE: false,
    isSafari: false,
    user: {
      userId: 0,
      level: 1,
      name: null,
      email: null,
      isLogin: false,
      isRoot: function() {
        return victory.user.level === victory.userLevel.root;
      }
    },
    ajax: function(http, args) {
      var h;
      if (args == null) {
        args = {};
      }
      if (args.method == null) {
        args.method = 'get';
      }
      if (args.cache == null) {
        args.cache = false;
      }
      if (args.data == null) {
        args.data = '';
      }
      if (args.error == null) {
        args.error = function() {};
      }
      if (args.success == null) {
        args.success = function() {};
      }
      victory.loading.on('Loading...');
      if (args.beforeSend) {
        args.beforeSend();
      }
      h = http({
        url: args.url,
        method: args.method,
        cache: args.ache,
        data: args.data
      });
      h.error(function(data, status, headers, config) {
        victory.loading.off();
        victory.message.error(status);
        return args.error(data, status, headers, config);
      });
      return h.success(function(data, status, headers, config) {
        victory.loading.off();
        if (data.__status__ === 302 && data.location) {
          location.href = data.location;
          return;
        }
        return args.success(data, status, headers, config);
      });
    },
    message: {
      error: function(status) {
        /*
        pop error message.
        */

        switch (status) {
          case 400:
            return $.av.pop({
              title: 'Input Failed',
              message: 'Please check input values.',
              template: 'error'
            });
          case 403:
            return $.av.pop({
              title: 'Permission denied',
              message: 'Please check your permission.',
              template: 'error'
            });
          default:
            return $.av.pop({
              title: 'Error',
              message: 'Loading failed, please try again later.',
              template: 'error'
            });
        }
      }
    },
    loading: {
      on: function(message) {
        /*
        loading
        */

        var loading, loading_height;
        $('body, a, .table-pointer tbody tr').css({
          cursor: 'wait'
        });
        if (victory.isIE) {
          return;
        }
        if ($('#loading').length > 0) {
          $('#loading .message').html(message);
          return;
        }
        loading = $('<div id="loading"><div class="spin"></div><div class="message">' + message + '</div><div class="clear"></div></div>');
        $('body').append(loading);
        loading_height = $('#loading').height();
        $('#loading').css({
          bottom: -loading_height
        });
        $('#loading').animate({
          bottom: '+=' + (loading_height + 10)
        }, 400, 'easeOutExpo');
        return Spinner({
          color: '#444',
          width: 2,
          length: 4,
          radius: 4
        }).spin($('#loading .spin')[0]);
      },
      off: function() {
        var loading_height;
        $('body').css({
          cursor: 'default'
        });
        $('a, .table-pointer tbody tr').css({
          cursor: 'pointer'
        });
        if (victory.isIE) {
          return;
        }
        $('#loading').dequeue();
        loading_height = $('#loading').height() + 10;
        return $('#loading').animate({
          bottom: '-=' + loading_height
        }, 400, 'easeInExpo', function() {
          return $(this).remove();
        });
      }
    },
    setup: {
      all: function() {
        var key;
        for (key in this) {
          if (key !== 'all') {
            this[key]();
          }
        }
      }
    }
  };

  window.victory = victory;

  user_agent = navigator.userAgent.toLowerCase();

  victory.isIE = user_agent.indexOf('msie') !== -1;

  victory.isSafari = user_agent.indexOf('safari') !== -1 && user_agent.indexOf('chrome') === -1;

}).call(this);
