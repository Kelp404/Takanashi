(function(){var b,f;b={if_first_pop:!0,text_loading:"Loading...",is_safari:!1,is_ie:!1,socket:null,is_modal_pop:!1,setup:function(){var a=this;this.setup_nav();this.setup_link();this.setup_enter_submit();return window.onpopstate=function(b){return a.pop_state(b.state)}},pop_state:function(a){this.if_first_pop?this.if_first_pop=!1:this.is_modal_pop?this.is_modal_pop=!1:(a?a.is_pop=!0:a={is_pop:!0,href:location.pathname},this.ajax(a,!1))},ajax:function(a,c){var g;g=$("#js_navigation li.active").index();
null==a.method&&(a.method="get");"get"!==a.method&&(c=!1);$.ajax({url:a.href,type:a.method,cache:!1,data:a.data,async:!(b.is_safari&&a.is_pop),beforeSend:function(c){var e;e="/"===a.href?1:$("#js_navigation li a[href*='"+a.href+"']").parent().index();b.nav_select(e);c.setRequestHeader("X-ajax","ajax");return b.loading_on(b.text_loading)},error:function(a){b.loading_off();b.error_message(a.status);return b.nav_select(g)},success:function(d,e,g){var f,h,l,k;if(d.__redirect)b.ajax({href:d.__redirect},
!0);else if(b.loading_off(),e=g.getResponseHeader("content-type"),0<=e.indexOf("json")&&400===d.__status)for(k=Object.keys(d),h=0,l=k.length;h<l;h++)g=k[h],f=d[g],e=$("#"+g).closest(".control-group"),e.find(".help-inline").remove(),f?(e.addClass("error"),e.find(".controls").append($("<label for='"+g+"' class='help-inline'>"+f+"</label>"))):e.removeClass("error");else{$(".modal.in").modal("hide");c?((a.href!==location.pathname||0<=location.href.indexOf("?"))&&history.pushState(a,document.title,a.href),
$("html, body").animate({scrollTop:0},500,"easeOutExpo")):history.state&&history.state.is_modal&&(b.is_modal_pop=!0,history.back());if(e=d.match(/<!ajax>/))return d=d.replace(/<!ajax>/,""),d=$("<div id='js_root'>"+d+"</div>"),document.title=d.find("title").text(),d.find(".js_ajax").each(function(){var a;a=$(this).attr("data-ajax-target");$("#"+a).html($(this).find("#"+a).html());$("#"+a).attr("class",$(this).find("#"+a).attr("class"))}),b.after_page_loaded();location.reload()}}});return!1},error_message:function(){return $.av.pop({title:"Error",
message:"Loading failed, please try again later.",template:"error"})},validation:function(a){var b;b=!0;a.find("input, textarea").each(function(){var a;if((a=$(this).attr("validation"))&&0<a.length){if($(this).val().match(a))return $(this).closest(".control-group").removeClass("error"),$(this).parent().find(".error_msg").remove();$(this).closest(".control-group").addClass("error");$(this).parent().find(".error_msg").remove();$(this).attr("msg")&&$(this).parent().append($('<label for="'+$(this).attr("id")+
'" class="error_msg help-inline">'+$(this).attr("msg")+"</label>"));return b=!1}});return b},loading_on:function(a){$("body, a, .table-pointer tbody tr").css({cursor:"wait"});if(!b.is_ie)if(0<$("#loading").length)$("#loading .message").html(a);else return a=$('<div id="loading"><div class="spin"></div><div class="message">'+a+'</div><div class="clear"></div></div>'),$("body").append(a),a=$("#loading").height(),$("#loading").css({bottom:-a}),$("#loading").animate({bottom:"+="+(a+10)},400,"easeOutExpo"),
Spinner({color:"#444",width:2,length:4,radius:4}).spin($("#loading .spin")[0])},loading_off:function(){var a;$("body").css({cursor:"default"});$("a, .table-pointer tbody tr").css({cursor:"pointer"});if(!b.is_ie)return $("#loading").dequeue(),a=$("#loading").height()+10,$("#loading").animate({bottom:"-="+a},400,"easeInExpo",function(){return $(this).remove()})},nav_select:function(a,b){null==b&&(b=!0);if(0<a&&!$($("#js_navigation li")[a]).hasClass("select"))return $("#js_navigation li").removeClass("select"),
$($("#js_navigation li")[a]).addClass("select"),b?$($("#js_navigation li")[a]).mouseover():$("#js_navigation li.cs_top").each(function(){return $(this).dequeue()}).animate({width:$("#js_navigation li.select").css("width"),left:$("#js_navigation li.select").position().left},0)},setup_nav:function(){var a;if(a=location.href.match(/\w(\/\w*)/))a="/"===a[1]?0:$('#js_navigation li a[href*="'+a[1]+'"]').parent().index(),$("#js_navigation li").removeClass("select"),$($("#js_navigation li")[a]).addClass("select");
$("#js_navigation li.select").parent().prepend($('<li class="cs_top"></li>'));$("#js_navigation li.cs_top").css({width:$("#js_navigation li.select").css("width"),left:$("#js_navigation li.select").position().left,top:$("#js_navigation li.select").position().top});a=function(){};$("#js_navigation li[class!=cs_top]").hover(function(){return $("#js_navigation li.cs_top").each(function(){return $(this).dequeue()}).animate({width:this.offsetWidth,left:this.offsetLeft},420,"easeInOutCubic")},a());return $("#js_navigation").hover(a(),
function(){return $("#js_navigation li.cs_top").each(function(){return $(this).dequeue()}).animate({width:$("#js_navigation li.select").css("width"),left:$("#js_navigation li.select").position().left},420,"easeInOutCubic")})},setup_link:function(){if(!this.is_ie)return $(document).on("click",".js_detail",function(a){var c;if(!a.metaKey&&(c=$(this).attr("data-detail-url").match(/(.*)#(.*)/)))return a=c[1],c=c[2],history.pushState({href:a,is_modal:!0},document.title,a),$("#"+c).on("shown",function(){$($(this).find("input")[0]).select();
return $(this).off("shown")}),$("#"+c).on("hidden",function(){history.state&&history.state.is_modal&&(b.is_modal_pop=!0,history.back());return $(this).off("hidden")}),$("#"+c).modal(),!1}),$(document).on("click",'a:not([href*="#"]):not([href^="javascript:"])',function(a){if(!a.metaKey&&(a=$(this).attr("href"))&&!$(this).attr("target"))return b.ajax({href:a},!0),!1}),$(document).on("submit",'form[method=get]:not([action*="#"])',function(){var a;a=$(this).attr("action")+"?"+$(this).serialize();b.ajax({href:a},
!0);return!1}),$(document).on("submit",'form[method=post]:not([action*="#"])',function(){var a;a=$(this).attr("action");b.ajax({href:a,data:$(this).serialize(),method:"post"});return!1}),$(document).on("submit",'form[method=put]:not([action*="#"])',function(){var a;a=$(this).attr("action");b.ajax({href:a,data:$(this).serialize(),method:"put"});return!1})},setup_enter_submit:function(){return $(document).on("keypress",".enter-submit",function(a){if(13===a.keyCode&&a.ctrlKey)return $(this).closest("form").submit(),
!1})},after_page_loaded:function(){b.setup_datetime();b.setup_focus();return b.setup_tooltip()},setup_datetime:function(){return $(".datetime").each(function(){var a;try{return a=new Date($(this).attr("datetime")),$(this).html(a.toFormat($(this).attr("format")))}catch(b){}})},setup_focus:function(){return $(".focus").select()},setup_tooltip:function(){return $('[rel="tooltip"]').tooltip()}};window.core=b;f=navigator.userAgent.toLowerCase();b.is_ie=-1!==f.indexOf("msie");b.is_safari=-1!==f.indexOf("safari")&&
-1===f.indexOf("chrome")}).call(this);
