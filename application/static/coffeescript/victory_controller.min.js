(function(){var c;c=angular.module("victory.controller",["victory.service"]);c.controller("NavigationCtrl",function($scope){var delay;delay=function(ms,func){return setTimeout(func,ms)};return $scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$scope.select=toState.name;$(".modal.in").modal("hide");return delay(0,function(){return $("#js_navigation li.select").mouseover()})})});c.controller("IndexCtrl",function($scope,$victory){if($scope.user.isLogin)return location.href=
"#/crashes/grouped";else return location.href="#/login"});c.controller("LoginCtrl",function($scope){return $scope.loginUrl=victory.loginUrl});c.controller("SettingsMenuCtrl",function($scope,$state){return $scope.active=$state.current.name});c.controller("SettingsCtrl",function(){return location.href="#/settings/applications"});c.controller("SettingsApplicationsCtrl",function($scope,$victory,applications){var item,_i,_len;for(_i=0,_len=applications.length;_i<_len;_i++){item=applications[_i];item.newName=
item.name;item.newDescription=item.description}$scope.items=applications;$scope.getApplications=function(){return $victory.setting.getApplications({success:function(data){var _j,_len1,_ref;_ref=data.items;for(_j=0,_len1=_ref.length;_j<_len1;_j++){item=_ref[_j];item.newName=item.name;item.newDescription=item.description}return $scope.items=data.items}})};$scope.addApplication=function(){return $victory.setting.addApplication({data:{name:$scope.name,description:$scope.description},error:function(data,
status){if(status===400&&data)return $scope.errors=data},success:function(){$scope.name="";$scope.description="";$(".modal.in").modal("hide");return $scope.getApplications()}})};$scope.updateApplication=function(id){var updateItem,x;updateItem=function(){var _j,_len1,_ref,_results;_ref=$scope.items;_results=[];for(_j=0,_len1=_ref.length;_j<_len1;_j++){x=_ref[_j];if(x.id===id)_results.push(x)}return _results}()[0];return $victory.setting.updateApplication({id:id,data:{name:updateItem.newName,description:updateItem.newDescription},
error:function(data,status){if(status===400&&data)return updateItem.errors=data},success:function(){$(".modal.in").modal("hide");return $scope.getApplications()}})};$scope.deleteApplication=function(id){return $victory.setting.deleteApplication({id:id,success:function(){$(".modal.in").modal("hide");return $scope.getApplications()}})};$scope.inviteUser=function(id,email){return $victory.setting.inviteUser({applicationId:id,email:email,success:function(){$(".modal.in").modal("hide");return $scope.getApplications()}})};
return $scope.deleteMenter=function(applicationId,memberId){return $victory.setting.deleteMember({applicationId:applicationId,memberId:memberId,success:function(){var application,x;application=function(){var _j,_len1,_ref,_results;_ref=$scope.items;_results=[];for(_j=0,_len1=_ref.length;_j<_len1;_j++){x=_ref[_j];if(x.id===applicationId)_results.push(x)}return _results}()[0];return application.members=function(){var _j,_len1,_ref,_results;_ref=application.members;_results=[];for(_j=0,_len1=_ref.length;_j<
_len1;_j++){x=_ref[_j];if(x.id!==memberId)_results.push(x)}return _results}()}})}});c.controller("SettingsUsersCtrl",function($scope,$victory,users){$scope.items=users;$scope.getUsers=function(){return $victory.setting.getUsers({success:function(data){return $scope.items=data.items}})};$scope.addUser=function(){return $victory.setting.addUser({email:$scope.email,success:function(){$scope.email="";return $scope.getUsers()}})};return $scope.deleteUser=function(id){return $victory.setting.deleteUser({id:id,
success:function(){var x;return $scope.items=function(){var _i,_len,_ref,_results;_ref=$scope.items;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];if(x.id!==id)_results.push(x)}return _results}()}})}});c.controller("SettingsProfileCtrl",function($scope,$victory,profile){$scope.profile=profile;$scope.getProfile=function(){return $victory.setting.getProfile({success:function(data){return $scope.profile=data}})};return $scope.updateProfile=function(){return $victory.setting.updateProfile({name:$scope.profile.name,
error:function(data,status){if(status===400&&data)return $scope.errors=data},success:function(){return $scope.getProfile()}})}});c.controller("GroupedDocumentsCtrl",function($scope,$stateParams,documentMode,groupedDocumentsAndApplications){$scope.documentMode=documentMode;$scope.keyword=$stateParams.keyword?$stateParams.keyword:"";$scope.applications=groupedDocumentsAndApplications.applications;$scope.groupedDocuments=groupedDocumentsAndApplications.groupedDocuments;$scope.page=groupedDocumentsAndApplications.page;
$scope.getGroupedDocumentsUrl=function(keyword,index){if(index==null)index=0;return"#/applications/"+$scope.selectedApplication.id+"/"+$scope.documentMode+"/grouped/"+keyword+"/"+index};$scope.gotoSearchPage=function(keyword,index){if(index==null)index=0;return location.href=$scope.getGroupedDocumentsUrl(keyword,index)};$scope.clickGroupedDocument=function(groupedDocument){if(groupedDocument.times>1||$scope.documentMode==="crashes")return location.href="#/applications/"+$scope.selectedApplication.id+
"/"+$scope.documentMode+"/"+groupedDocument.group_tag};return $scope.modal=function(groupedDocument){if(groupedDocument.times>1)return"";else return"modal"}});c.controller("DocumentsCtrl",function($scope,$victory,documentMode,documents){$scope.documentMode=documentMode;$scope.documents=documents;$victory.application.getApplications({success:function(data){return $scope.applications=data.items}});return $scope.renderDescription=function(document){if(document.description)return document.description;
else if(document.parameters)return"Parameters: "+document.parameters;else if(document.url)return"URL: "+document.url;return""}});c.controller("CrashDocumentCtrl",function($scope,$victory,documentMode,crash){$scope.documentMode=documentMode;$scope.crash=crash;return $victory.application.getApplications({success:function(data){return $scope.applications=data.items}})})}).call(this);
